<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">  <!-- Use Chrome Frame in IE -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="description" content="A simple KML example.">
    <meta name="cesium-sandcastle-labels" content="Showcases, DataSources">
    <title>Dynamic Style Changing</title>
    <script type="text/javascript" src="Sandcastle-header.js"></script>
	<script src="../../../../Build/Cesium/Cesium.js"></script>
</head>
<body class="sandcastle-loading" data-sandcastle-bucket="bucket-requirejs.html">
<style>
    @import url(../../../Sandcastle/templates/bucket.css);
</style>
<div id="cesiumContainer" class="fullSize"></div>
<div id="loadingOverlay"><h1>Loading...</h1></div>
<div id="Sources"></div>

<script id="cesium_sandcastle_script">
function startup(Cesium) {
	
	var DayStyles = [0xBB0000FF, 0xBBFFFF00, 0xBB00FF00, 0xBB00FFFF, 0xBBFFFFFF];
	var NightStyles = [0xBB0000B4, 0xBBB4B400, 0xBB00B400, 0xBB00B4B4, 0xBBB4B4B4];
	
	var drawType = 'polygon';
	//Entities have properties (Polyline, Polygon)
	//Properties have values
	function detectDrawType() {
		for(var i = 0; i < 20; i++) {
			var value = viewer.dataSources.get(0).entities.values[0].propertyNames[i];
			//console.log(dataSource.entities.values[0][value]);
			if(typeof viewer.dataSources.get(0).entities.values[0][value] !== "undefined" && viewer.dataSources.get(0).entities.values[0][value].hasOwnProperty('_material')) {
				drawType = value;
				//console.log(viewer.dataSources.get(0).entities.values[0][value].hasOwnProperty('_material'));
			}
		}
	}
	
	function changeColor(color) {
		console.log("Called function.");
		var numberOfEntities = viewer.dataSources.get(0).entities.values.length;
		var color = Cesium.Color.fromRgba(color);
		for(i = 0; i < numberOfEntities; i++) {
			//console.log("Looping");
			var entitiesList = viewer.dataSources.get(0).entities;
			entitiesList.getById(entitiesList.values[i].id)[drawType].outlineColor = color;
			entitiesList.getById(entitiesList.values[i].id)[drawType].material = color;
		}
	};
	
	var viewer = new Cesium.Viewer('cesiumContainer', {
		animation : false,
		baseLayerPicker : false,
		fullscreenButton : false,
		geocoder : false,
		homeButton : false,
		sceneModePicker : false,
		timeline : false,
		navigationHelpButton : false
	});
	
	viewer.dataSources.add(Cesium.KmlDataSource.load("../Resources/coverage0.kmz")).then(function(dataSource) {
	
		detectDrawType();
		//console.log("Past drawtype");
		Sandcastle.addToolbarMenu([{
			text : 'DayStyle1',
			onselect : function() {
				var i = 0;
				console.log("Daystyle1");
				console.log(viewer.dataSources.get(0).entities.values.length);
				changeColor(DayStyles[0]);
			}
		}, {
			text : 'DayStyle2',
			onselect : function() {
				var i = 0;
				console.log("Daystyle2");
				console.log(viewer.dataSources.get(0).entities.values.length);
				changeColor(DayStyles[1]);
			}
		}, {
			text : 'DayStyle3',
			onselect : function() {
				var i = 0;
				console.log("Daystyle3");
				console.log(viewer.dataSources.get(0).entities.values.length);
				changeColor(DayStyles[2]);
			}
		}, {
			text : 'DayStyle4',
			onselect : function() {
				var i = 0;
				console.log("Daystyle4");
				console.log(viewer.dataSources.get(0).entities.values.length);
				changeColor(DayStyles[3]);
			}
		}, {
			text : 'DayStyle5',
			onselect : function() {
				var i = 0;
				console.log("Daystyle5");
				console.log(viewer.dataSources.get(0).entities.values.length);
				changeColor(DayStyles[4]);
			}
		}, {
			text : 'NightStyle1',
			onselect : function() {
				var i = 0;
				console.log("Nightstyle1");
				console.log(viewer.dataSources.get(0).entities.values.length);
				changeColor(NightStyles[0]);
			}
		}, {
			text : 'NightStyle2',
			onselect : function() {
				var i = 0;
				console.log("Nightstyle2");
				console.log(viewer.dataSources.get(0).entities.values.length);
				changeColor(NightStyles[1]);
			}
		}, {
			text : 'NightStyle3',
			onselect : function() {
				var i = 0;
				console.log("Nightstyle3");
				console.log(viewer.dataSources.get(0).entities.values.length);
				changeColor(NightStyles[2]);
			}
		}, {
			text : 'NightStyle4',
			onselect : function() {
				var i = 0;
				console.log("Nightstyle4");
				console.log(viewer.dataSources.get(0).entities.values.length);
				changeColor(NightStyles[3]);
			}
		}, {
			text : 'NightStyle5',
			onselect : function() {
				var i = 0;
				console.log("Nightstyle5");
				console.log(viewer.dataSources.get(0).entities.values.length);
				changeColor(NightStyles[4]);
			}
		}], 'Sources');
		
		Sandcastle.finishedLoading();
	
	});
}

if (typeof Cesium !== "undefined") {
    startup(Cesium);
} else if (typeof require === "function") {
    require(["Cesium"], startup);
}
</script>
</body>
</html>
