<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">  <!-- Use Chrome Frame in IE -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="description" content="A simple KML example.">
    <meta name="cesium-sandcastle-labels" content="Showcases, DataSources">
    <title>Multiple Globes</title>
    <script type="text/javascript" src="Sandcastle-header.js"></script>
	<script src="../../../../Build/Cesium/Cesium.js"></script>
</head>
<body class="sandcastle-loading" data-sandcastle-bucket="bucket-requirejs.html">
<style>
    @import url(../../../Sandcastle/templates/multiglobe.css);
</style>
<div id="cesiumContainer" class="fullSize"></div>
<div id="loadingOverlay"><h1>Loading...</h1></div>
<div id="Sources"></div>

<script id="cesium_sandcastle_script">
function startup(Cesium) {
	
	var DayStyles = [0xBB0000FF, 0xBBFFFF00, 0xBB00FF00, 0xBB00FFFF, 0xBBFFFFFF];
	var NightStyles = [0xBB0000B4, 0xBBB4B400, 0xBB00B400, 0xBB00B4B4, 0xBBB4B4B4];
	var visibleFirst = [true, true, true];
	var visibleSecond = [true, true, true];
	var Source = 0;
	var drawType = ['polygon', 'polygon'];
	//Entities have properties (Polyline, Polygon)
	//Properties have values
	function detectDrawType() {
		for(n = 0; n < 2; n++) {
			for(var i = 0; i < 20; i++) {
				var value = viewers[n].dataSources.get(Source).entities.values[0].propertyNames[i];
				//console.log(dataSource.entities.values[0][value]);
				if(typeof viewers[n].dataSources.get(Source).entities.values[0][value] !== "undefined" && viewers[n].dataSources.get(Source).entities.values[0][value].hasOwnProperty('_material')) {
					drawType[n] = value;
					//console.log(viewer.dataSources.get(Source).entities.values[0][value].hasOwnProperty('_material'));
				}
			}
		}
	}
	
	function changeColor(color, n) {
		console.log("Called function.");
		var length = viewers[n].dataSources.get(Source).entities.values.length;
		var entitiesList = viewers[n].dataSources.get(Source).entities;
		for(i = 0; i < length; i++) {
			//console.log("Looping");
			entitiesList.getById(entitiesList.values[i].id)[drawType[n]].outlineColor = Cesium.Color.fromRgba(color);
			entitiesList.getById(entitiesList.values[i].id)[drawType[n]].material = Cesium.Color.fromRgba(color);
		}
	};
	
	
	var firstViewer = new Cesium.Viewer('cesiumContainer', {
		animation : false,
		baseLayerPicker : false,
		fullscreenButton : false,
		geocoder : false,
		homeButton : false,
		sceneModePicker : false,
		timeline : false,
		navigationHelpButton : false
	});
	
	var secondViewer = new Cesium.Viewer('cesiumContainer', {
		animation : false,
		baseLayerPicker : false,
		fullscreenButton : false,
		geocoder : false,
		homeButton : false,
		sceneModePicker : false,
		timeline : false,
		navigationHelpButton : false
	});
	
	var viewers = [firstViewer, secondViewer];
	
	function generate() {
		console.log("Entering generate");
		viewers[0].dataSources.add(Cesium.KmlDataSource.load("../Resources/coverage2.kmz"));
		viewers[0].dataSources.add(Cesium.KmlDataSource.load("../Resources/coverage6.kmz"));
		viewers[0].dataSources.add(Cesium.KmlDataSource.load("../Resources/coverage0.kmz")).then(function(dataSource) {
			console.log("inside datasources");
			Sandcastle.addToolbarMenu([{
				text : 'Source 1',
				onselect : function() {
					console.log("Source 1");
					Source = 0;
					detectDrawType(0);
				}
			}, {
				text : 'Source 2',
				onselect : function() {
					console.log("Source 2");
					Source = 1;
					detectDrawType(0);
				}
			}, {
				text : 'Source 3',
				onselect : function() {
					console.log("Source 3");
					Source = 2;
					detectDrawType(0);
				}
			}], 'Sources');
			
			Sandcastle.addToolbarMenu([{
				text : 'DayStyle1',
				onselect : function() {
					console.log("Daystyle1");
					console.log(viewers[0].dataSources.get(Source).entities.values.length);
					changeColor(DayStyles[0], 0);
				}
			}, {
				text : 'DayStyle2',
				onselect : function() {
					console.log("Daystyle2");
					console.log(viewers[0].dataSources.get(Source).entities.values.length);
					changeColor(DayStyles[1], 0);
				}
			}, {
				text : 'DayStyle3',
				onselect : function() {
					console.log("Daystyle3");
					console.log(viewers[0].dataSources.get(Source).entities.values.length);
					changeColor(DayStyles[2], 0);
				}
			}, {
				text : 'DayStyle4',
				onselect : function() {
					console.log("Daystyle4");
					console.log(viewers[0].dataSources.get(Source).entities.values.length);
					changeColor(DayStyles[3], 0);
				}
			}, {
				text : 'DayStyle5',
				onselect : function() {
					console.log("Daystyle5");
					console.log(viewers[0].dataSources.get(Source).entities.values.length);
					changeColor(DayStyles[4], 0);
				}
			}, {
				text : 'NightStyle1',
				onselect : function() {
					console.log("Nightstyle1");
					console.log(viewers[0].dataSources.get(Source).entities.values.length);
					changeColor(NightStyles[0], 0);
				}
			}, {
				text : 'NightStyle2',
				onselect : function() {
					console.log("Nightstyle2");
					console.log(viewers[0].dataSources.get(Source).entities.values.length);
					changeColor(NightStyles[1], 0);
				}
			}, {
				text : 'NightStyle3',
				onselect : function() {
					console.log("Nightstyle3");
					console.log(viewers[0].dataSources.get(Source).entities.values.length);
					changeColor(NightStyles[2], 0);
				}
			}, {
				text : 'NightStyle4',
				onselect : function() {
					console.log("Nightstyle4");
					console.log(viewers[0].dataSources.get(Source).entities.values.length);
					changeColor(NightStyles[3], 0);
				}
			}, {
				text : 'NightStyle5',
				onselect : function() {
					console.log("Nightstyle5");
					console.log(viewers[0].dataSources.get(Source).entities.values.length);
					changeColor(NightStyles[4], 0);
				}
			}], 'Sources');
			
			Sandcastle.addToolbarButton('Toggle Enable',
				function() {
					console.log("Toggle Enable");
					visibleFirst[Source] = !visibleFirst[Source];
					for(i = 0; i < viewers[0].dataSources.get(Source).entities.values.length; i++) {
						//console.log("Looping");
						viewers[0].dataSources.get(Source).entities.getById(viewers[0].dataSources.get(Source).entities.values[i].id).show = visibleFirst[Source];
					}
				}
			, 'Sources');
		
		});
		
		console.log("finished first viewer");
		
		viewers[1].dataSources.add(Cesium.KmlDataSource.load("../Resources/coverage2.kmz"));
		viewers[1].dataSources.add(Cesium.KmlDataSource.load("../Resources/coverage6.kmz"));
		viewers[1].dataSources.add(Cesium.KmlDataSource.load("../Resources/coverage0.kmz")).then(function(dataSource) {
			console.log("inside datasources");
			Sandcastle.addToolbarMenu([{
				text : 'DayStyle1',
				onselect : function() {
					console.log("Daystyle1");
					console.log(viewers[1].dataSources.get(Source).entities.values.length);
					changeColor(DayStyles[0], 1);
				}
			}, {
				text : 'DayStyle2',
				onselect : function() {
					console.log("Daystyle2");
					console.log(viewers[1].dataSources.get(Source).entities.values.length);
					changeColor(DayStyles[1], 1);
				}
			}, {
				text : 'DayStyle3',
				onselect : function() {
					console.log("Daystyle3");
					console.log(viewers[1].dataSources.get(Source).entities.values.length);
					changeColor(DayStyles[2], 1);
				}
			}, {
				text : 'DayStyle4',
				onselect : function() {
					console.log("Daystyle4");
					console.log(viewers[1].dataSources.get(Source).entities.values.length);
					changeColor(DayStyles[3], 1);
				}
			}, {
				text : 'DayStyle5',
				onselect : function() {
					console.log("Daystyle5");
					console.log(viewers[1].dataSources.get(Source).entities.values.length);
					changeColor(DayStyles[4], 1);
				}
			}, {
				text : 'NightStyle1',
				onselect : function() {
					console.log("Nightstyle1");
					console.log(viewers[1].dataSources.get(Source).entities.values.length);
					changeColor(NightStyles[0], 1);
				}
			}, {
				text : 'NightStyle2',
				onselect : function() {
					console.log("Nightstyle2");
					console.log(viewers[1].dataSources.get(Source).entities.values.length);
					changeColor(NightStyles[1], 1);
				}
			}, {
				text : 'NightStyle3',
				onselect : function() {
					console.log("Nightstyle3");
					console.log(viewers[1].dataSources.get(Source).entities.values.length);
					changeColor(NightStyles[2], 1);
				}
			}, {
				text : 'NightStyle4',
				onselect : function() {
					console.log("Nightstyle4");
					console.log(viewers[1].dataSources.get(Source).entities.values.length);
					changeColor(NightStyles[3], 1);
				}
			}, {
				text : 'NightStyle5',
				onselect : function() {
					console.log("Nightstyle5");
					console.log(viewers[1].dataSources.get(Source).entities.values.length);
					changeColor(NightStyles[4], 1);
				}
			}], 'Sources');
			
			Sandcastle.addToolbarButton('Toggle Enable',
				function() {
					console.log("Toggle Enable");
					visibleSecond[Source] = !visibleSecond[Source];
					for(i = 0; i < viewers[1].dataSources.get(Source).entities.values.length; i++) {
						//console.log("Looping");
						viewers[1].dataSources.get(Source).entities.getById(viewers[1].dataSources.get(Source).entities.values[i].id).show = visibleSecond[Source];
					}
				}
			, 'Sources');
		
		});
	}
	
	generate();
	
	Sandcastle.finishedLoading();
}
	
if (typeof Cesium !== "undefined") {
    startup(Cesium);
} else if (typeof require === "function") {
    require(["Cesium"], startup);
}

</script>
</body>
</html>
